<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speech Recognition Example</title>
</head>
<body>
  <h1>Speech Recognition Example</h1>
  <button id="startBtn">Start Recognition</button>
  <p id="output">Your speech will appear here...</p>

  <script>
    // Check if the browser supports the SpeechRecognition API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
  
      recognition.onresult = async function (event) {
        console transcript = event.results[0][0].transcript; 
        console.log(event);

        
      }
      recognition.startBtn.addEventListener('click', function() {
        recognition.start(); // Start the speech recognition
        document.getElementById('output').textContent = 'Listening...';
      });
      
      // Configure the SpeechRecognition settings
      recognition.lang = 'en-US';  // Language: English (US)
      recognition.interimResults = true;  // Allow showing partial results
      recognition.maxAlternatives = 1;  // Limit to one alternative result

      // Store transcribed text
      let transcribedText = ''; // This will hold the speech text
      let lastTranscribedText = ''; // This will store the last transcribed text to avoid repetition

      // Display the recognition status
      recognition.onstart = function() {
        document.getElementById('output').textContent = 'Listening...';
      };

      // Handle speech recognition results
      recognition.onresult = function(event) {
        let transcript = '';

        // Loop through all results and concatenate them into one transcript
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript += event.results[i][0].transcript;
        }

        // Avoid repeating the same transcript (check if it's new)
        let sentenceHistory = []; // Array to store last 5 sentences

// Function to check if any words in the new sentence were used in the last 5 sentences
function hasRepeatedWords(sentence) {
  const wordsInHistory = new Set(); // Store words from the last 5 sentences

  // Add words from the last 5 sentences to the set
  sentenceHistory.forEach((sentence) => {
    sentence.split(' ').forEach((word) => {
      wordsInHistory.add(word.toLowerCase()); // Convert to lowercase to avoid case sensitivity
    });
  });

  // Check if any word in the current sentence is repeated
  const wordsInCurrentSentence = sentence.split(' ');
  for (const word of wordsInCurrentSentence) {
    if (wordsInHistory.has(word.toLowerCase())) {
      return true; // If a word is found in the history, return true
    }
  }
  return false; // No repetition found
}

// Example usage inside the recognition result:
if (transcript.trim() !== lastTranscribedText.trim()) {
  if (!hasRepeatedWords(transcript)) {
    transcribedText += transcript + ' ';
    lastTranscribedText = transcript.trim();

    // Add the sentence to the history
    sentenceHistory.push(transcript.trim());

    // Keep only the last 5 sentences in the history
    if (sentenceHistory.length > 5) {
      sentenceHistory.shift(); // Remove the oldest sentence if we have more than 5
    }

    // Display the current transcription
    document.getElementById('output').textContent = 'You said: ' + transcribedText;
  } else {
    document.getElementById('output').textContent = 'Repetition detected, ignoring sentence.';
  }
}

          // Display the current transcription
          document.getElementById('output').textContent = 'You said: ' + transcribedText;

          // Check if the transcript contains "ok" or "okay" and stop recognition
          if (transcript.toLowerCase().includes("ok") || transcript.toLowerCase().includes("okay")) {
            recognition.stop(); // Stop listening if "ok" or "okay" is detected
            document.getElementById('output').textContent = 'Recognition stopped. You said: ' + transcribedText;
          }
        }
      };

      // Handle recognition end
      recognition.onend = function() {
        document.getElementById('output').textContent += ' (Stopped)';
      };
    }
  </script>
</body>
</html>
